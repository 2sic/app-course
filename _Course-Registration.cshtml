@inherits ToSic.Sxc.Dnn.RazorComponent
@using ToSic.Razor.Blade;
@using Connect.Koi;
@{
  var helpers = CreateInstance("shared/_Helpers.cshtml");
}

@RenderPage("shared/_Assets.cshtml") 

@{
    var course = AsList(App.Data["Event"]).Where(x => x.EntityId == Convert.ToInt32(Request.QueryString["cid"])).FirstOrDefault();
    
    var eventDateRaw = AsList(App.Data["EventDate"]).Where(evd => evd.Event.Count > 0);
    var eventDate = eventDateRaw.Where(ed => ed.Event[0].EntityId == Convert.ToInt32(Request.QueryString["cid"])).FirstOrDefault();
    
    eventDate = AsList(App.Data["EventDate"]).Where(ed => ed.EntityId == Convert.ToInt32(Request.QueryString["did"])).FirstOrDefault();;
    
    var title = (course == null ? "" : course.Title);

    HtmlPage.Title = "Anmeldung" + " | " + title + " | " + Dnn.Module.ParentTab.TabName + " | " + Dnn.Portal.PortalName;
}

@if (course == null) {
    <div class="alert alert-danger" role="alert">
        <span class="sr-only">Error:</span>
        @App.Resources.CourseNotFoundError
    </div>
} else {
    <div class="app-course app-course-form" @Edit.TagToolbar(Content) data-string-required="@App.Resources.ValidationRequired" data-string-email="@App.Resources.ValidationEmail">
        <h1>@App.Resources.CourseRegistrationTitle - @course.Title @((!String.IsNullOrEmpty(eventDate.TitleAddition)) ? App.Resources.TitleAdditionPrefix + " " + eventDate.TitleAddition + " " + App.Resources.TitleAdditionSuffix : "" )</h1>
        <div class="form cf-wrapper cform-id-@Dnn.Module.ModuleID">
            @helpers.Textbox(App.Resources.LabelCourseNumber, "CourseNumber", true, disabled: true, value: ((eventDate.Id != null) ? eventDate.Id : course.id))
            @helpers.Textbox(App.Resources.LabelCourseName, "CourseName", true, disabled: true, value: course.Title )
            @helpers.Textbox(App.Resources.LabelCourseLocation, "CourseLocation", true, disabled: true, value: course.Location)
            
            <div class="form-group row">
                @helpers.Label(App.Resources.LabelCourseDate, "Date")
                <div class="col-sm-9">
                    @{
                        var compDate = eventDate.Start.ToString("d") + ((eventDate.End != null) ? " - " + eventDate.End.ToString("d")  : "");
                    }
                    <textarea required class="form-control" id="Date" name="Date" disabled="disabled" rows="3">@(Text.Has(eventDate.TimeSpecifics) ? eventDate.TimeSpecifics : compDate)</textarea>
                </div>
            </div>
            
            <h3>@App.Resources.CourseParticipantData</h3>
            <div class="form-group row">
                @helpers.Label(App.Resources.LabelParticipantSalutation, "Salutation")
                <div class="col-sm-9">
                    <div class="radio">
                        <label>
                            <input name="Salutation" type="radio" value="@App.Resources.LabelMrs">
                            @App.Resources.LabelMrs
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input name="Salutation" type="radio" value="@App.Resources.LabelMr">
                            @App.Resources.LabelMr
                        </label>
                    </div>
                    
                </div>
            </div>

            @helpers.Textbox(App.Resources.LabelParticipantFirstName, "FirstName", true)
            @helpers.Textbox(App.Resources.LabelParticipantLastName, "LastName", true)
            @helpers.Textbox(App.Resources.LabelParticipantStreet, "Street")
            @helpers.Textbox(App.Resources.LabelParticipantZIPCity, "ZIPCity")
            
            <div class="form-group row cf-required">
                @helpers.Label(App.Resources.LabelParticipantCountry, "Country")
                <div class="col-sm-9">
                    <select class="form-control" id="Country" name="Country" required>
                        <option value="">@App.Resources.PleaseSelectCountry</option>
                        @foreach(var country in App.Resources.CountrySelection.Split('\n')) {
                            <option value="@country">@country</option>
                        }
                    </select>
                </div>
            </div>

            @helpers.Textbox(App.Resources.LabelParticipantPhone, "Phone")
            @helpers.Textbox(App.Resources.LabelParticipantMobilePhone, "MobilePhone")
            @helpers.Textbox(App.Resources.LabelParticipantMail, "Mail", true, "email")
            
            <div class="form-group row cf-required">
                <label class="col-sm-3" for="AGB">@App.Resources.AppAgbLabel</label>
                <div class="col-sm-9">
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" id="AGB" name="AGB" required /> @Html.Raw(App.Resources.AcceptAgb.Replace("<p>", "").Replace("</p>", ""))
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="form-group row cf-required">
                <label class="col-sm-3" for="Accept">@App.Resources.AppCostsLabel</label>
                <div class="col-sm-9">
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" id="Accept" name="Accept" required /> @Html.Raw(App.Resources.AcceptCosts.Replace("<p>", "").Replace("</p>", ""))
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-md-9 offset-sm-3")>
                    <button type="button" class="cf-submit btn btn-primary">@Html.Raw(App.Resources.ButtonRegister)</button>
                </div>
            </div>

            <input type="hidden" id="EventDateEntity" name="EventDateEntity" value="@eventDate.EntityGuid" >
            <input type="hidden" id="Course" name="Course" value="@course.EntityGuid">
        </div>

        <div class="cf-info-sent alert alert-success" style="display:none;">
            <strong>@App.Resources.SuccessThanks</strong>
            @App.Resources.SuccessMessage
        </div>

        <div class="cf-info-error alert alert-danger" style="display:none;">
            @App.Resources.CourseRegistrationError
        </div>
    </div>
}